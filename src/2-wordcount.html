<!doctype html>
<html>

<head>
  <title>drop.that</title>
  <style>
    html,
    body {
      width: 100%;
      height: 100%;
      min-height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-family: monospace;
    }
  </style>
</head>

<body>
  <script type="module">
    import { dropIn, dropOut } from './lib.js'

    const wordCount = (input) =>
      Object.entries(
        input
          .toLocaleLowerCase()
          .replace(/[^a-z ]/g, '')
          .replace(/[ ]+/g, ' ')
          .trim()
          .split(' ')
          .reduce((a, c) => (a[c] ? a[c]++ : a[c] = 1, a), {})
      )
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10)

    const createGraph = (count) =>
`<svg viewBox="0 0 100 70" width="800" height="560">
<defs><style>
.b{fill:none;stroke:#0000ff;stroke-width:4;}
.n{fill:black;font-size:2px;font-family:sans-serif;dominant-baseline:middle;text-align:right;}
.w{fill:#a0a0a0;font-size:2px;font-family:sans-serif;dominant-baseline:middle;}
</style></defs>
<g>
<path class="b" d="${count.map(([_, n], i) => `M 20 ${(i + 2) * 5} l ${n} 0`).join()
}" />
${count.map(([w, n], i) =>
`<text class="n" x="15" y="${(i + 2) * 5}">${n}</text>
<text class="w" x="22" y="${(i + 2) * 5}">${w}</text>`)
.join('\n')}
</g></svg>`

    const input = await dropIn({
      fetchDefault: 'wordcount.txt',
      startButtonText: 'wordcount'
    })
    const graph = createGraph(wordCount(input))
    await dropOut(graph, {
      downloadFileName: 'wordcount.svg',
      downloadFileMimeType: 'image/svg',
    })
  </script>
</body>

</html>